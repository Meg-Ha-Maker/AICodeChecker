name: API Based Validator

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    outputs:
      decision: ${{ steps.mock_api.outputs.decision }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 1: MOCK API CALL (for now)
      # Change "approved" to "rejected" to test both flows
      - name: Fake API response (testing)
        id: mock_api
        run: |
          echo "Simulating API call..."
          echo "decision=approved" >> $GITHUB_OUTPUT
          # For rejecting use:
          # echo "decision=rejected" >> $GITHUB_OUTPUT

      # Step 2: Fail workflow if decision != approved
      - name: Block if rejected
        run: |
          if [[ "${{ steps.mock_api.outputs.decision }}" != "approved" ]]; then
            echo "API returned rejected — cannot merge."
            exit 1
          else
            echo "API returned approved — merge allowed."
          fi
